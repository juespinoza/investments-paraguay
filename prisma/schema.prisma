// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

enum Role {
  ADMIN
  INMOBILIARIA
  ASESOR
  BLOGUERO
}

enum SocialPlatform {
  WHATSAPP
  EMAIL
  BLOG
  WEB
  INSTAGRAM
  FACEBOOK
  X
  TIKTOK
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  name      String?
  password  String
  role      Role     @default(ASESOR)

  inmobiliariaId String?
  advisorId       String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  deletedAt DateTime?
}

model Inmobiliaria {
  id          String  @id @default(cuid())
  name        String
  slug        String  @unique
  description String?
  logoUrl     String?
  themeJson   Json?

  blogs       BlogPost[]
  properties  Property[]
  advisors    Advisor[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  deletedAt DateTime?
}

model Advisor {
  id          String  @id @default(cuid())
  fullName    String
  slug        String  @unique
  bio         String?
  phone       String?
  whatsapp    String?
  instagram   String?
  photoUrl    String?

  blogs       BlogPost[]
  properties  Property[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  deletedAt DateTime?

  // Landing base fields
  headline   String?  // slogan
  heroBgUrl  String?  // background puede ser null
  ctaLabel   String?  // por defecto lo setear치s desde UI
  ctaHref    String?

  // Relaci칩n opcional con inmobiliaria
  inmobiliariaId String?
  inmobiliaria   Inmobiliaria? @relation(fields: [inmobiliariaId], references: [id])

  // 1:1 landing editable
  landing   LandingAdvisor?
}

model Property {
  id             String   @id @default(cuid())
  title          String
  slug           String   @unique
  priceUsd       Int?
  city           String?
  description    String?
  coverImageUrl  String?
  gallery        String[] // simple
  inmobiliariaId String?
  inmobiliaria   Inmobiliaria? @relation(fields: [inmobiliariaId], references: [id])
  advisorId       String?
  advisor         Advisor? @relation(fields: [advisorId], references: [id])
  featuredInLandings LandingAdvisorFeaturedProperty[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  deletedAt DateTime?
}

model BlogPost {
  id             String   @id @default(cuid())
  title          String
  slug           String   @unique
  content        String
  coverImageUrl  String?

  inmobiliariaId String?
  inmobiliaria   Inmobiliaria? @relation(fields: [inmobiliariaId], references: [id])

  advisorId       String?
  advisor         Advisor? @relation(fields: [advisorId], references: [id])

  authorRole     Role

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  deletedAt DateTime?
}

model LandingAdvisor {
  id        String   @id @default(cuid())
  advisorId  String   @unique
  advisor    Advisor   @relation(fields: [advisorId], references: [id], onDelete: Cascade)

  // ABOUT
  aboutImageUrl    String
  aboutTitle       String
  startDate        DateTime
  company          String
  aboutDescription String?
  aboutParagraph1  String
  aboutParagraph2  String

  // SERVICES
  servicesParagraph1 String
  servicesParagraph2 String

  propertyTypes  LandingAdvisorPropertyType[]
  clientTypes    LandingAdvisorClientType[]
  areas          LandingAdvisorArea[]
  serviceList    LandingAdvisorServiceItem[]

  // Featured properties (m치x 3 por regla en backend)
  featuredProperties LandingAdvisorFeaturedProperty[]

  // Testimonios y redes (pueden estar ac치 para mantener "la landing" completa)
  testimonies  AdvisorTestimonial[]
  socialMedia  AdvisorSocialLink[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  deletedAt DateTime?
}

model LandingAdvisorPropertyType {
  id        String @id @default(cuid())
  value     String
  landingId String
  landing   LandingAdvisor @relation(fields: [landingId], references: [id], onDelete: Cascade)

  @@index([landingId])
}

model LandingAdvisorClientType {
  id        String @id @default(cuid())
  value     String
  landingId String
  landing   LandingAdvisor @relation(fields: [landingId], references: [id], onDelete: Cascade)

  @@index([landingId])
}

model LandingAdvisorArea {
  id        String @id @default(cuid())
  value     String
  landingId String
  landing   LandingAdvisor @relation(fields: [landingId], references: [id], onDelete: Cascade)

  @@index([landingId])
}

model LandingAdvisorServiceItem {
  id        String @id @default(cuid())
  value     String
  landingId String
  landing   LandingAdvisor @relation(fields: [landingId], references: [id], onDelete: Cascade)

  @@index([landingId])
}

model LandingAdvisorFeaturedProperty {
  id         String @id @default(cuid())
  landingId  String
  propertyId String
  order      Int

  landing  LandingAdvisor @relation(fields: [landingId], references: [id], onDelete: Cascade)
  property Property      @relation(fields: [propertyId], references: [id], onDelete: Cascade)

  @@unique([landingId, propertyId])
  @@unique([landingId, order])
  @@index([landingId])
}

model AdvisorTestimonial {
  id        String @id @default(cuid())
  name      String
  text      String

  landingId String
  landing   LandingAdvisor @relation(fields: [landingId], references: [id], onDelete: Cascade)

  @@index([landingId])
}

model AdvisorSocialLink {
  id        String @id @default(cuid())
  label     String
  value     String
  href      String
  platform  SocialPlatform

  landingId String
  landing   LandingAdvisor @relation(fields: [landingId], references: [id], onDelete: Cascade)

  @@index([landingId])
}